<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Individual Disease Report - HealthGuard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
    background: linear-gradient(135deg,#fafcff,#ffffff);
    font-family: Arial, sans-serif;
    min-height:100vh;
}

.navbar{
    background:black;
    padding:15px 20px;
}

.navbar h4{
    color:#fff;
    margin:0;
}

.report-card{
    background:#fff;
    border-radius:16px;
    box-shadow:0 15px 40px rgba(0,0,0,0.2);
    padding:35px;
    max-width:650px;
    margin:120px auto 60px auto;
}

.report-card h2{
    text-align:center;
    margin-bottom:15px;
    color:#2c3e50;
}

.report-card p{
    text-align:center;
    color:#666;
    margin-bottom:25px;
}

.form-label{
    font-weight:600;
}

.form-control, .form-select{
    border-radius:8px;
    padding:10px 12px;
}

.form-control:focus, .form-select:focus{
    box-shadow:0 0 0 0.2rem rgba(13,110,253,.15);
    border-color:#0d6efd;
}

.submit-btn{
    width:100%;
    padding:12px;
    border-radius:10px;
    color:#fff;
    font-weight:bold;
    background:#0d6efd;
    border:none;
    transition:0.3s;
}

.submit-btn:hover{
    background:#015de7;
}

.declaration-box{
    font-size:14px;
    color:#555;
}

@media(max-width:576px){
    .report-card{
        margin:100px 15px 40px 15px;
        padding:25px;
    }
}
</style>
</head>
<body>

<nav class="navbar">
  <div class="d-flex align-items-center">
    <img src="images/icon1.png" width="40" height="40" class="me-2">
    <h4>HealthGuard</h4>
  </div>
</nav>

<div class="report-card">

<h2>Individual Disease Report</h2>
<p>Help us monitor viral outbreaks in your area</p>

<form id="individualReportForm">

<!-- Personal Info -->
<div class="row g-3">

<div class="col-md-6">
<label class="form-label">Full Name *</label>
<input type="text" class="form-control" id="fullName" required>
</div>

<div class="col-md-6">
<label class="form-label">Phone Number *</label>
<input type="tel" class="form-control" id="phoneNumber" pattern="[0-9]{10}" placeholder="10-digit number" required>
</div>

</div>

<hr class="my-4">

<!-- Location -->
<div class="row g-3">

<div class="col-md-4">
<label class="form-label">State *</label>
<select class="form-select" id="stateSelect" required>
<option value="">Select State</option>
<option value="Maharashtra">Maharashtra</option>
</select>
</div>

<div class="col-md-4">
<label class="form-label">District *</label>
<select class="form-select" id="districtSelect" required disabled>
<option value="">Select District</option>
</select>
</div>

<div class="col-md-4">
<label class="form-label">Area / Region *</label>
<select class="form-select" id="areaSelect" required disabled>
<option value="">Select Area</option>
</select>
</div>

</div>


<hr class="my-4">

<!-- Disease Info -->
<div class="row g-3">

<div class="col-md-6">
<label class="form-label">Disease *</label>
<select class="form-select" id="diseaseSelect" required>
<option value="">Select Disease</option>
<option value="COVID-19">COVID-19</option>
<option value="Dengue">Dengue</option>
<option value="Malaria">Malaria</option>
<option value="Chikungunya">Chikungunya</option>
<option value="Swine Flu">Swine Flu</option>
</select>
</div>

<div class="col-md-6">
<label class="form-label">Date of Diagnosis *</label>
<input type="date" class="form-control" id="diagnosisDate" required>
</div>

<div class="col-md-6">
<label class="form-label">Confirmed by Doctor? *</label>
<select class="form-select" id="doctorConfirmed" required>
<option value="">Select Option</option>
<option value="Yes">Yes</option>
<option value="No">No</option>
</select>
</div>

</div>

<hr class="my-4">

<!-- Declaration -->
<div class="form-check declaration-box mb-3">
<input class="form-check-input" type="checkbox" id="declarationCheck" required>
<label class="form-check-label" for="declarationCheck">
I agree that this report is genuine and not fake. I understand that submitting false information may result in consequences.
</label>
</div>

<button type="submit" class="submit-btn">
Submit Report
</button>

</form>

</div>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const stateSelect = document.getElementById("stateSelect");
  const districtSelect = document.getElementById("districtSelect");
  const areaSelect = document.getElementById("areaSelect");
  const form = document.getElementById("individualReportForm");
  const submitBtn = form.querySelector("button[type='submit']");

  // Disable dependent dropdowns initially
  districtSelect.disabled = true;
  areaSelect.disabled = true;

  // =============================
  // LOAD DISTRICTS FROM BACKEND
  // =============================
  stateSelect.addEventListener("change", async function () {

    const state = this.value;

    districtSelect.innerHTML = '<option value="">Loading...</option>';
    areaSelect.innerHTML = '<option value="">Select Area</option>';

    districtSelect.disabled = true;
    areaSelect.disabled = true;

    if (!state) return;

    try {
      const res = await fetch(`/api/regions/districts/${encodeURIComponent(state)}`);

      if (!res.ok) throw new Error("Network response failed");

      const data = await res.json();

      districtSelect.innerHTML = '<option value="">Select District</option>';

      if (data.success && data.districts.length > 0) {

        data.districts.forEach(d => {
          const option = document.createElement("option");
          option.value = d.district;
          option.textContent = d.district;
          districtSelect.appendChild(option);
        });

        districtSelect.disabled = false;

      } else {
        districtSelect.innerHTML = '<option value="">No districts available</option>';
      }

    } catch (err) {
      console.error("District load error:", err);
      districtSelect.innerHTML = '<option value="">Failed to load</option>';
    }
  });

  // =============================
  // LOAD AREAS FROM BACKEND
  // =============================
  districtSelect.addEventListener("change", async function () {

    const state = stateSelect.value;
    const district = this.value;

    areaSelect.innerHTML = '<option value="">Loading...</option>';
    areaSelect.disabled = true;

    if (!district) return;

    try {
      const res = await fetch(`/api/regions/areas/${encodeURIComponent(state)}/${encodeURIComponent(district)}`);

      if (!res.ok) throw new Error("Network response failed");

      const data = await res.json();

      areaSelect.innerHTML = '<option value="">Select Area</option>';

      if (data.success && data.areas.length > 0) {

        data.areas.forEach(a => {
          const option = document.createElement("option");
          option.value = a.area_name;
          option.textContent = a.area_name;
          areaSelect.appendChild(option);
        });

        areaSelect.disabled = false;

      } else {
        areaSelect.innerHTML = '<option value="">No areas available</option>';
      }

    } catch (err) {
      console.error("Area load error:", err);
      areaSelect.innerHTML = '<option value="">Failed to load</option>';
    }
  });

  // =============================
  // FORM SUBMIT
  // =============================
  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    if (!form.checkValidity()) {
      alert("Please fill all required fields correctly.");
      return;
    }

    const fullName = document.getElementById("fullName").value.trim();
    const phone = document.getElementById("phoneNumber").value.trim();
    const state = stateSelect.value;
    const district = districtSelect.value;
    const area = areaSelect.value;
    const disease = document.getElementById("diseaseSelect").value;
    const diagnosisDate = document.getElementById("diagnosisDate").value;
    const doctorConfirmed = document.getElementById("doctorConfirmed").value;
    const declaration = document.getElementById("declarationCheck").checked;

    // Extra validation
    if (!/^\d{10}$/.test(phone)) {
      alert("Phone number must be exactly 10 digits.");
      return;
    }

    if (!declaration) {
      alert("You must agree to the declaration.");
      return;
    }

    submitBtn.disabled = true;
    submitBtn.innerText = "Submitting...";

    try {
      const res = await fetch("/api/reports/submit", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          fullName,
          phone,
          state,
          district,
          area,
          disease,
          diagnosisDate,
          doctorConfirmed
        })
      });

      if (!res.ok) throw new Error("Submission failed");

      const data = await res.json();

      if (data.success) {

        alert("Report submitted successfully. Thank you for helping your community.");

        form.reset();
        districtSelect.disabled = true;
        areaSelect.disabled = true;

      } else {
        alert(data.message || "Submission failed.");
      }

    } catch (err) {
      console.error("Submit error:", err);
      alert("Server error. Please try again later.");
    }

    submitBtn.disabled = false;
    submitBtn.innerText = "Submit Report";
  });

});
</script>


</body>
</html>
